<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gzzhwl.core.data.extdao.DriverContractInfoExtDao">

	<resultMap id="driverContractInfoResultMap" type="DriverContractInfo">
		<id property="contractId" column="contract_id" />
		<result property="loadId" column="load_id" />
	</resultMap>
	<resultMap id="pageResultMap"  type="java.util.HashMap" extends="driverContractInfoResultMap">
		<result property="loadNo" column="load_no" />
		<result property="plateNumber" column="plate_number" />
		<result property="startCodeP" column="start_code_p" />
		<result property="startCodeC" column="start_code_c" />
		<result property="endCodeP" column="end_code_p" />
		<result property="endCodeC" column="end_code_c" />
		<result property="freightPrice" column="freight_price" />
		<result property="orderNo" column="order_no" />
		<result property="status" column="status" />
		<result property="createdTime" column="created_time" />
	</resultMap>
		
		
	<resultMap id="findResultMap"  type="java.util.HashMap" extends="driverContractInfoResultMap"></resultMap>

	<select id="getContractList" parameterType="map" resultMap="pageResultMap">
		SELECT DISTINCT
			zdci.contract_id,
			zoli.load_no,
			zrvi.plate_number,
			line.start_code_p,
			line.start_code_c,
			line.end_code_p,
			line.end_code_c,
			zoli.freight_price,
			zodi.order_no,
			zoli.status,
			zoli.created_time
		FROM
			zh_driver_contract_info zdci
		INNER JOIN (
			zh_order_load_info zoli
			LEFT JOIN zh_real_vehicle_info zrvi ON zoli.vehicle_info_id = zrvi.vehicle_info_id
			INNER JOIN (
				zh_order_detail_info zodi
				LEFT JOIN zh_order_line_info line ON zodi.info_id = line.info_id
			) ON zoli.order_id = zodi.order_id and zodi.is_deleted = #{isDeleted}
		) ON zdci.contract_id = zoli.load_id
		AND zoli.type = #{contractType}
		INNER JOIN zh_order_load_info load_zoli ON zdci.load_id = load_zoli.load_id
		AND load_zoli.type = #{loadType}
		LEFT JOIN (
			zh_load_driver_info zldi 
			LEFT JOIN zh_real_driver_info zrdi ON zldi.driver_info_id = zrdi.driver_info_id and zrdi.is_deleted = #{isDeleted}
		)ON zdci.contract_id = zldi.load_id
	   <trim prefix="WHERE" prefixOverrides="AND |OR ">
	     <if test="keyWord != null">
	        (zoli.load_no = #{keyWord} or load_zoli.load_no = #{keyWord} or zrvi.plate_number = #{keyWord})
	     </if>
	     <if test="status != null">
	        and zoli.status=#{status}
	     </if>
	     <if test="supplyId != null">
	        and zoli.supply_id=#{supplyId}
	     </if>
	     <if test="startCodeP != null">
	        and line.start_code_p=#{startCodeP}
	     </if>
	     <if test="startCodeC != null">
	        and line.start_code_c=#{startCodeC}
	     </if>
	     <if test="endCodeP != null">
	        and line.end_code_p=#{endCodeP}
	     </if>
	     <if test="endCodeC != null">
	        and line.end_code_c=#{endCodeC}
	     </if>
	     <if test="realName != null">
	        and zrdi.real_name=#{realName}
	     </if>
	     <if test="telphone != null">
	        and zrdi.telphone=#{telphone}
	     </if>
	     <if test="loadStartTime != null">
	        and load_zoli.created_time >= #{loadStartTime}
	     </if>
	     <if test="loadEndTime != null">
	        <![CDATA[ and load_zoli.created_time <= #{loadEndTime} ]]>
	     </if>    
	     <if test="conStartTime != null">
	        and zoli.created_time >= #{conStartTime}
	     </if>
	     <if test="conEndTime != null">
	        <![CDATA[ and zoli.created_time <= #{conEndTime} ]]>
	     </if>
	     <if test="contractStatus != null">
	        and zoli.status = #{contractStatus}
	     </if>
	  	 <if test="sort != null and  sort == 00" >
	       	 order by zoli.created_time asc
	     </if>
	      <if test="sort != null and sort == 01">
	       	 order by zoli.created_time desc
	     </if>
	   </trim>
	</select>
</mapper> 